---
- hosts: all
  tasks:
    - name: Ensure docker python SDK is installed
      become: true
      pip:
        name: "docker"
        state: present

    - name: List all containers
      docker_host_info:
        images: yes
        images_filters:
          reference: "kolla/*"
      register: docker_host_info

    - name: Login to Dockerhub
      docker_login:
        username: "{{ kolla_dockerhub_creds.user | trim }}"
        password: "{{ kolla_dockerhub_creds.password | trim }}"

    - name: Push built container images
      docker_image:
        name: "{{ item.RepoTags.0 }}"
        push: yes
      loop: "{{ docker_host_info.images }}"
